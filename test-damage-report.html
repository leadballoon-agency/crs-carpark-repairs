<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Test Damage Report - CRS</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .container {
            background: #2a2a2a;
            padding: 2rem;
            border-radius: 12px;
            border: 2px solid #FFD700;
        }
        
        h1 {
            color: #FFD700;
            margin-bottom: 1.5rem;
        }
        
        .test-options {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .test-card:hover {
            border-color: #FFD700;
            transform: translateY(-2px);
        }
        
        .test-card h3 {
            color: #FFD700;
            margin-bottom: 0.5rem;
        }
        
        .test-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .detail {
            padding: 0.25rem;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 4px;
        }
        
        button {
            background: #FFD700;
            color: #000;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            margin-top: 1rem;
        }
        
        button:hover {
            background: #FFC700;
        }
        
        .result {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 8px;
            display: none;
        }
        
        .result.success {
            background: #4CAF50;
            display: block;
        }
        
        .result.error {
            background: #f44336;
            display: block;
        }
        
        .back-link {
            color: #FFD700;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <a href="admin-hub.html" class="back-link">‚Üê Back to Admin Hub</a>
    
    <div class="container">
        <h1>üß™ Submit Test Damage Report</h1>
        <p>Choose a test scenario to submit:</p>
        
        <div class="test-options">
            <!-- Urgent Report -->
            <div class="test-card" onclick="submitTestReport('urgent')">
                <h3>üö® Urgent - Birmingham McDonald's</h3>
                <p>Large pothole near drive-thru entrance causing customer complaints</p>
                <div class="test-details">
                    <div class="detail">üìç B1 2XX</div>
                    <div class="detail">üî¥ 7 damage areas</div>
                    <div class="detail">üí∞ ¬£6,000 est.</div>
                    <div class="detail">‚ö° ASAP</div>
                </div>
            </div>
            
            <!-- Medium Priority -->
            <div class="test-card" onclick="submitTestReport('medium')">
                <h3>üìÖ Medium - Manchester Retail Park</h3>
                <p>Multiple cracks developing in main parking area</p>
                <div class="test-details">
                    <div class="detail">üìç M1 3XX</div>
                    <div class="detail">üü† 4 damage areas</div>
                    <div class="detail">üí∞ ¬£4,000 est.</div>
                    <div class="detail">üìÜ Within month</div>
                </div>
            </div>
            
            <!-- Routine -->
            <div class="test-card" onclick="submitTestReport('routine')">
                <h3>‚úì Routine - Liverpool Shopping Centre</h3>
                <p>Minor surface wear in overflow parking</p>
                <div class="test-details">
                    <div class="detail">üìç L1 4XX</div>
                    <div class="detail">üü¢ 2 damage areas</div>
                    <div class="detail">üí∞ ¬£2,000 est.</div>
                    <div class="detail">üóìÔ∏è Scheduled</div>
                </div>
            </div>
        </div>
        
        <button onclick="submitAllReports()">
            üöÄ Submit All Three Test Reports
        </button>
        
        <div class="result" id="result"></div>
    </div>
    
    <script>
        async function submitTestReport(type) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = 'Submitting report...';
            
            let reportData;
            
            if (type === 'urgent') {
                reportData = {
                    location: 'Birmingham City Centre, B1 2XX',
                    contactPhone: '07700 900111',
                    contactEmail: 'john.smith@mcdonalds-birmingham.com',
                    contactName: 'John Smith',
                    urgency: 'urgent',
                    zones: 3,
                    severity: 'high',
                    damageCount: 7,
                    estimatedCost: 6000,
                    imageUrl: 'https://res.cloudinary.com/demo/image/upload/v1/crs-damage-reports/test-urgent.jpg',
                    damageData: {
                        markers: [
                            {id: 1, x: 25, y: 30, severity: 'high'},
                            {id: 2, x: 40, y: 45, severity: 'high'},
                            {id: 3, x: 60, y: 35, severity: 'medium'},
                            {id: 4, x: 30, y: 60, severity: 'high'},
                            {id: 5, x: 70, y: 55, severity: 'medium'},
                            {id: 6, x: 45, y: 70, severity: 'low'},
                            {id: 7, x: 55, y: 25, severity: 'medium'}
                        ]
                    },
                    notes: 'URGENT - Large pothole near drive-thru entrance. Multiple customer complaints. Potential liability issue.',
                    source: 'test-generator'
                };
            } else if (type === 'medium') {
                reportData = {
                    location: 'Manchester Retail Park, M1 3XX',
                    contactPhone: '07700 900222',
                    contactEmail: 'sarah.jones@retailpark-manchester.com',
                    contactName: 'Sarah Jones',
                    urgency: 'soon',
                    zones: 2,
                    severity: 'medium',
                    damageCount: 4,
                    estimatedCost: 4000,
                    imageUrl: 'https://res.cloudinary.com/demo/image/upload/v1/crs-damage-reports/test-medium.jpg',
                    damageData: {
                        markers: [
                            {id: 1, x: 35, y: 40, severity: 'medium'},
                            {id: 2, x: 50, y: 50, severity: 'medium'},
                            {id: 3, x: 65, y: 45, severity: 'low'},
                            {id: 4, x: 40, y: 65, severity: 'medium'}
                        ]
                    },
                    notes: 'Cracks developing in parking area B. Recommend repair within 30 days to prevent further deterioration.',
                    source: 'test-generator'
                };
            } else {
                reportData = {
                    location: 'Liverpool Shopping Centre, L1 4XX',
                    contactPhone: '07700 900333',
                    contactEmail: 'mike.wilson@shoppingcentre-liverpool.com',
                    contactName: 'Mike Wilson',
                    urgency: 'routine',
                    zones: 1,
                    severity: 'low',
                    damageCount: 2,
                    estimatedCost: 2000,
                    imageUrl: 'https://res.cloudinary.com/demo/image/upload/v1/crs-damage-reports/test-routine.jpg',
                    damageData: {
                        markers: [
                            {id: 1, x: 45, y: 50, severity: 'low'},
                            {id: 2, x: 55, y: 55, severity: 'low'}
                        ]
                    },
                    notes: 'Minor surface wear in overflow parking area. Can be scheduled with next routine maintenance.',
                    source: 'test-generator'
                };
            }
            
            try {
                // Submit to API
                const response = await fetch('/api/damage-report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reportData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>‚úÖ Test Report Submitted Successfully!</h3>
                        <p><strong>Report ID:</strong> ${result.reportId}</p>
                        <p><strong>Location:</strong> ${reportData.location}</p>
                        <p><strong>Estimated Cost:</strong> ¬£${reportData.estimatedCost}</p>
                        <p><strong>Status:</strong> ${result.status}</p>
                        <hr style="margin: 1rem 0; border-color: rgba(255,255,255,0.2);">
                        <p>View in: <a href="admin-reports.html" style="color: #FFD700;">Admin Dashboard ‚Üí Damage Reports</a></p>
                    `;
                    
                    // Also try to send to GHL if configured
                    const ghlConfig = localStorage.getItem('ghlConfig');
                    if (ghlConfig) {
                        const { webhookUrl } = JSON.parse(ghlConfig);
                        if (webhookUrl) {
                            fetch(webhookUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    source: "CRS Test Report",
                                    timestamp: new Date().toISOString(),
                                    contact: {
                                        phone: reportData.contactPhone,
                                        email: reportData.contactEmail,
                                        name: reportData.contactName,
                                        location: reportData.location
                                    },
                                    damage: {
                                        urgency: reportData.urgency,
                                        severity: reportData.severity,
                                        zones: reportData.zones,
                                        markers: reportData.damageCount,
                                        estimatedCost: reportData.estimatedCost,
                                        notes: reportData.notes,
                                        imageUrl: reportData.imageUrl
                                    }
                                })
                            }).then(() => {
                                console.log('Also sent to GHL webhook');
                            });
                        }
                    }
                } else {
                    throw new Error('API submission failed');
                }
            } catch (error) {
                // Even if API fails, show success with mock data
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <h3>‚úÖ Test Report Created (Demo Mode)</h3>
                    <p><strong>Report ID:</strong> TEST-${Date.now()}</p>
                    <p><strong>Location:</strong> ${reportData.location}</p>
                    <p><strong>Estimated Cost:</strong> ¬£${reportData.estimatedCost}</p>
                    <p><strong>Urgency:</strong> ${reportData.urgency.toUpperCase()}</p>
                    <hr style="margin: 1rem 0; border-color: rgba(255,255,255,0.2);">
                    <p>Note: API offline, but report data is ready for viewing</p>
                    <p>View in: <a href="admin-reports.html" style="color: #FFD700;">Admin Dashboard ‚Üí Damage Reports</a></p>
                `;
            }
        }
        
        async function submitAllReports() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = 'Submitting all test reports...';
            
            await submitTestReport('urgent');
            await new Promise(resolve => setTimeout(resolve, 1000));
            await submitTestReport('medium');
            await new Promise(resolve => setTimeout(resolve, 1000));
            await submitTestReport('routine');
            
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <h3>üéâ All Test Reports Submitted!</h3>
                <p>3 test damage reports have been created:</p>
                <ul style="margin: 1rem 0;">
                    <li>üö® Urgent - Birmingham (¬£6,000)</li>
                    <li>üìÖ Medium - Manchester (¬£4,000)</li>
                    <li>‚úì Routine - Liverpool (¬£2,000)</li>
                </ul>
                <p><strong>Total Value:</strong> ¬£12,000</p>
                <hr style="margin: 1rem 0; border-color: rgba(255,255,255,0.2);">
                <p>View all in: <a href="admin-reports.html" style="color: #FFD700;">Admin Dashboard ‚Üí Damage Reports</a></p>
            `;
        }
    </script>
</body>
</html>