<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Priority Client Management - CRS</title>
    <link rel="icon" type="image/png" href="images/logo-3.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --yellow: #FFD700;
            --black: #1a1a1a;
            --dark-gray: #2a2a2a;
            --medium-gray: #3a3a3a;
            --essential: #718096;
            --enterprise: #6B46C1;
            --green: #4CAF50;
            --red: #f44336;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--black);
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            background: var(--dark-gray);
            padding: 2rem;
            border-radius: 16px;
            border: 2px solid var(--yellow);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            color: var(--yellow);
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .back-btn {
            background: var(--yellow);
            color: var(--black);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
        }
        
        /* Revenue Stats */
        .revenue-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--dark-gray);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .stat-card h3 {
            color: #999;
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--yellow);
        }
        
        .stat-change {
            color: var(--green);
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        .stat-change.negative {
            color: var(--red);
        }
        
        /* Compact Priority Tiers */
        .priority-tiers {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .tier-card {
            background: var(--dark-gray);
            border-radius: 12px;
            padding: 1rem;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .tier-card.essential {
            border-color: var(--essential);
        }
        
        .tier-card.professional {
            border-color: var(--yellow);
        }
        
        .tier-card.enterprise {
            border-color: var(--enterprise);
            background: linear-gradient(135deg, rgba(107, 70, 193, 0.05), rgba(103, 126, 234, 0.05));
        }
        
        .tier-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .tier-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .tier-name {
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .tier-card.essential .tier-name {
            color: var(--essential);
        }
        
        .tier-card.professional .tier-name {
            color: var(--yellow);
        }
        
        .tier-card.enterprise .tier-name {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .tier-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: #fff;
        }
        
        .tier-stats {
            display: flex;
            justify-content: space-between;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tier-stat {
            text-align: center;
        }
        
        .tier-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--yellow);
            display: block;
        }
        
        .tier-stat-label {
            font-size: 0.75rem;
            color: #999;
            text-transform: uppercase;
        }
        
        /* Priority Clients List */
        .clients-section {
            background: var(--dark-gray);
            padding: 2rem;
            border-radius: 16px;
            border: 2px solid rgba(255, 215, 0, 0.2);
            margin-bottom: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            color: var(--yellow);
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .filter-tabs {
            display: flex;
            gap: 0.5rem;
        }
        
        .filter-tab {
            padding: 0.5rem 1rem;
            background: var(--medium-gray);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-tab.active {
            background: var(--yellow);
            color: var(--black);
        }
        
        .clients-grid {
            display: grid;
            gap: 1rem;
        }
        
        .client-row {
            background: var(--medium-gray);
            padding: 1.5rem;
            border-radius: 12px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto;
            gap: 1rem;
            align-items: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .client-row:hover {
            border-color: var(--yellow);
            transform: translateY(-2px);
        }
        
        .client-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .client-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--yellow);
            color: var(--black);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .client-details h3 {
            color: var(--yellow);
            margin-bottom: 0.25rem;
        }
        
        .client-details p {
            color: #999;
            font-size: 0.9rem;
        }
        
        .plan-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            text-align: center;
        }
        
        .plan-badge.essential {
            background: var(--essential);
            color: white;
        }
        
        .plan-badge.professional {
            background: var(--yellow);
            color: var(--black);
        }
        
        .plan-badge.enterprise {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .revenue-amount {
            color: var(--green);
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .response-time {
            color: #999;
            font-size: 0.9rem;
        }
        
        .sites-count {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            padding: 0.5rem;
            background: rgba(255, 215, 0, 0.1);
            color: var(--yellow);
            border: 1px solid var(--yellow);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            background: var(--yellow);
            color: var(--black);
        }
        
        /* Alert Section */
        .priority-alert {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.1), rgba(255, 152, 0, 0.1));
            border: 2px solid var(--red);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .priority-alert h3 {
            color: var(--red);
            margin-bottom: 1rem;
        }
        
        .alert-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .alert-info {
            flex: 1;
        }
        
        .alert-badge {
            background: var(--red);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .btn-primary {
            background: var(--yellow);
            color: var(--black);
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }
        
        @media (max-width: 1200px) {
            .client-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }
        
        @media (max-width: 768px) {
            .priority-tiers {
                grid-template-columns: 1fr;
            }
            
            .revenue-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>👑 Priority Client Management</h1>
            <a href="admin-hub.html" class="back-btn">← Back to Admin Hub</a>
        </div>
        
        <!-- Revenue Statistics -->
        <div class="revenue-stats">
            <div class="stat-card">
                <h3>Monthly Recurring Revenue</h3>
                <div class="stat-value">£12,394</div>
                <div class="stat-change">↑ 18% from last month</div>
            </div>
            
            <div class="stat-card">
                <h3>Total Priority Clients</h3>
                <div class="stat-value">47</div>
                <div class="stat-change">↑ 3 new this month</div>
            </div>
            
            <div class="stat-card">
                <h3>Average Client Value</h3>
                <div class="stat-value">£263</div>
                <div class="stat-change">↑ £15 increase</div>
            </div>
            
            <div class="stat-card">
                <h3>Priority Response Rate</h3>
                <div class="stat-value">98.5%</div>
                <div class="stat-change">Within SLA targets</div>
            </div>
            
            <div class="stat-card">
                <h3>Churn Rate</h3>
                <div class="stat-value">2.1%</div>
                <div class="stat-change">↓ 0.5% improvement</div>
            </div>
            
            <div class="stat-card">
                <h3>Lifetime Value</h3>
                <div class="stat-value">£9,456</div>
                <div class="stat-change">Per priority client</div>
            </div>
        </div>
        
        <!-- Priority Alerts -->
        <div class="priority-alert" id="priority-alerts">
            <h3>🚨 Priority Client Alerts</h3>
            <div id="alerts-list">
                <!-- Populated by JavaScript -->
            </div>
        </div>
        
        <!-- Compact Priority Tiers Summary -->
        <div class="priority-tiers" id="priority-tiers">
            <!-- Populated by JavaScript from settings -->
        </div>
        
        <!-- Priority Clients List -->
        <div class="clients-section">
            <div class="section-header">
                <h2 class="section-title">Priority Clients</h2>
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterClients('all')">All</button>
                    <button class="filter-tab" onclick="filterClients('enterprise')">Enterprise</button>
                    <button class="filter-tab" onclick="filterClients('professional')">Professional</button>
                    <button class="filter-tab" onclick="filterClients('essential')">Essential</button>
                </div>
            </div>
            
            <div class="clients-grid" id="clients-list">
                <!-- Populated by JavaScript -->
            </div>
        </div>
        
        <!-- Add New Priority Client -->
        <div style="text-align: center; margin-top: 2rem;">
            <button class="btn-primary" onclick="window.location.href='admin-management.html'">
                ➕ Add New Priority Client
            </button>
        </div>
    </div>
    
    <script>
        // Load settings from localStorage
        function loadPrioritySettings() {
            const storedSettings = localStorage.getItem('siteSettings');
            if (storedSettings) {
                return JSON.parse(storedSettings);
            }
            
            // Default settings if none stored
            return {
                priorityPlans: {
                    essential: {
                        name: "Essential",
                        price: 199,
                        features: ["48-hour response", "Quarterly inspection", "20% repair discount", "Priority scheduling"]
                    },
                    professional: {
                        name: "Professional", 
                        price: 499,
                        features: ["24-hour response", "Monthly inspection", "30% repair discount", "Emergency hotline", "Detailed reporting"]
                    },
                    enterprise: {
                        name: "Enterprise",
                        price: "Custom",
                        features: ["Same-day response", "Bi-weekly inspection", "Unlimited minor repairs", "24/7 emergency support", "Dedicated account manager", "Custom reporting dashboard"]
                    }
                }
            };
        }
        
        // Render compact tier cards
        function renderTierCards() {
            const settings = loadPrioritySettings();
            const tiersContainer = document.getElementById('priority-tiers');
            
            // Calculate client counts and MRR for each tier
            const tierStats = {
                essential: { count: 23, mrr: 0 },
                professional: { count: 19, mrr: 0 },
                enterprise: { count: 5, mrr: 0 }
            };
            
            // Calculate MRR based on settings prices
            tierStats.essential.mrr = tierStats.essential.count * settings.priorityPlans.essential.price;
            tierStats.professional.mrr = tierStats.professional.count * settings.priorityPlans.professional.price;
            // For enterprise, use a default estimate if Custom
            const enterprisePrice = settings.priorityPlans.enterprise.price === 'Custom' ? 1500 : settings.priorityPlans.enterprise.price;
            tierStats.enterprise.mrr = tierStats.enterprise.count * enterprisePrice;
            
            const totalMRR = tierStats.essential.mrr + tierStats.professional.mrr + tierStats.enterprise.mrr;
            
            // Calculate revenue percentages and profit margins
            // Assuming higher tiers have better margins due to efficiency
            const margins = {
                essential: 0.35,    // 35% profit margin
                professional: 0.45,      // 45% profit margin
                enterprise: 0.60   // 60% profit margin (economies of scale)
            };
            
            tiersContainer.innerHTML = `
                <div class="tier-card essential">
                    <div class="tier-header">
                        <div class="tier-name">ESSENTIAL</div>
                        <div class="tier-price">£${settings.priorityPlans.essential.price}/mo</div>
                    </div>
                    <div class="tier-stats">
                        <div class="tier-stat">
                            <span class="tier-stat-value">${tierStats.essential.count}</span>
                            <span class="tier-stat-label">Clients</span>
                        </div>
                        <div class="tier-stat">
                            <span class="tier-stat-value">${Math.round((tierStats.essential.mrr / totalMRR) * 100)}%</span>
                            <span class="tier-stat-label">of Revenue</span>
                        </div>
                        <div class="tier-stat">
                            <span class="tier-stat-value" style="color: ${margins.essential >= 0.4 ? 'var(--green)' : 'var(--yellow)'};">${Math.round(margins.essential * 100)}%</span>
                            <span class="tier-stat-label">Margin</span>
                        </div>
                    </div>
                </div>
                
                <div class="tier-card professional">
                    <div class="tier-header">
                        <div class="tier-name">PROFESSIONAL</div>
                        <div class="tier-price">£${settings.priorityPlans.professional.price}/mo</div>
                    </div>
                    <div class="tier-stats">
                        <div class="tier-stat">
                            <span class="tier-stat-value">${tierStats.professional.count}</span>
                            <span class="tier-stat-label">Clients</span>
                        </div>
                        <div class="tier-stat">
                            <span class="tier-stat-value">${Math.round((tierStats.professional.mrr / totalMRR) * 100)}%</span>
                            <span class="tier-stat-label">of Revenue</span>
                        </div>
                        <div class="tier-stat">
                            <span class="tier-stat-value" style="color: ${margins.professional >= 0.4 ? 'var(--green)' : 'var(--yellow)'};">${Math.round(margins.professional * 100)}%</span>
                            <span class="tier-stat-label">Margin</span>
                        </div>
                    </div>
                </div>
                
                <div class="tier-card enterprise">
                    <div class="tier-header">
                        <div class="tier-name">ENTERPRISE</div>
                        <div class="tier-price">${settings.priorityPlans.enterprise.price === 'Custom' ? 'Custom' : `£${settings.priorityPlans.enterprise.price}/mo`}</div>
                    </div>
                    <div class="tier-stats">
                        <div class="tier-stat">
                            <span class="tier-stat-value">${tierStats.enterprise.count}</span>
                            <span class="tier-stat-label">Clients</span>
                        </div>
                        <div class="tier-stat">
                            <span class="tier-stat-value">${Math.round((tierStats.enterprise.mrr / totalMRR) * 100)}%</span>
                            <span class="tier-stat-label">of Revenue</span>
                        </div>
                        <div class="tier-stat">
                            <span class="tier-stat-value" style="color: var(--green);">${Math.round(margins.enterprise * 100)}%</span>
                            <span class="tier-stat-label">Margin</span>
                        </div>
                    </div>
                </div>
            `;
            const mrrElement = document.querySelector('.stat-value');
            if (mrrElement) {
                mrrElement.textContent = `£${totalMRR.toLocaleString()}`;
            }
        }
        
        // Sample priority clients data
        const priorityClients = [
            {
                id: 1,
                name: "McDonald's Birmingham",
                contact: "John Richardson",
                plan: "enterprise",
                revenue: 1500, // Custom pricing estimate
                responseTime: "Same day",
                sites: 8,
                joinDate: "2024-01-15",
                hasAlert: true,
                alertMessage: "New damage report submitted - requires immediate attention"
            },
            {
                id: 2,
                name: "Tesco Express Network",
                contact: "Sarah Mitchell",
                plan: "enterprise",
                revenue: 1500, // Custom pricing estimate
                responseTime: "Same day",
                sites: 12,
                joinDate: "2024-02-20"
            },
            {
                id: 3,
                name: "Sainsbury's Local",
                contact: "Michael Brown",
                plan: "professional",
                revenue: 499,
                responseTime: "24 hours",
                sites: 6,
                joinDate: "2024-03-10"
            },
            {
                id: 4,
                name: "Costa Coffee Franchise",
                contact: "Emma Wilson",
                plan: "professional",
                revenue: 499,
                responseTime: "24 hours",
                sites: 4,
                joinDate: "2024-04-05"
            },
            {
                id: 5,
                name: "Premier Inn Liverpool",
                contact: "David Jones",
                plan: "essential",
                revenue: 199,
                responseTime: "48 hours",
                sites: 2,
                joinDate: "2024-05-12"
            },
            {
                id: 6,
                name: "Holiday Inn Manchester",
                contact: "Lisa Taylor",
                plan: "essential",
                revenue: 199,
                responseTime: "48 hours",
                sites: 1,
                joinDate: "2024-06-08",
                hasAlert: true,
                alertMessage: "Subscription renewal due in 5 days"
            }
        ];
        
        // Load priority alerts
        function loadAlerts() {
            const alertsList = document.getElementById('alerts-list');
            const alerts = priorityClients.filter(c => c.hasAlert);
            
            if (alerts.length === 0) {
                document.getElementById('priority-alerts').style.display = 'none';
                return;
            }
            
            alertsList.innerHTML = alerts.map(client => `
                <div class="alert-item">
                    <div class="alert-info">
                        <strong>${client.name}</strong> - ${client.alertMessage}
                    </div>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <span class="plan-badge ${client.plan}">${client.plan.toUpperCase()}</span>
                        <button class="action-btn" onclick="handleAlert(${client.id})">
                            Handle →
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Render clients list
        function renderClients(filter = 'all') {
            const clientsList = document.getElementById('clients-list');
            const filtered = filter === 'all' 
                ? priorityClients 
                : priorityClients.filter(c => c.plan === filter);
            
            clientsList.innerHTML = filtered.map(client => `
                <div class="client-row">
                    <div class="client-info">
                        <div class="client-avatar">
                            ${client.name.substring(0, 2).toUpperCase()}
                        </div>
                        <div class="client-details">
                            <h3>${client.name}</h3>
                            <p>${client.contact} • Joined ${new Date(client.joinDate).toLocaleDateString()}</p>
                        </div>
                    </div>
                    
                    <div class="plan-badge ${client.plan}">
                        ${client.plan.toUpperCase()}
                    </div>
                    
                    <div class="revenue-amount">
                        £${client.revenue}/mo
                    </div>
                    
                    <div class="response-time">
                        ⚡ ${client.responseTime}
                    </div>
                    
                    <div class="sites-count">
                        <strong>${client.sites}</strong> sites
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="viewClient(${client.id})" title="View Details">
                            👁️
                        </button>
                        <button class="action-btn" onclick="contactClient(${client.id})" title="Contact">
                            📞
                        </button>
                        <button class="action-btn" onclick="viewReports(${client.id})" title="View Reports">
                            📊
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Filter clients
        function filterClients(filter) {
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Render filtered clients
            renderClients(filter);
        }
        
        // Handle alert
        function handleAlert(clientId) {
            const client = priorityClients.find(c => c.id === clientId);
            if (client.alertMessage.includes('damage report')) {
                window.location.href = 'admin-reports.html';
            } else {
                alert(`Handling alert for ${client.name}`);
            }
        }
        
        // View client details
        function viewClient(id) {
            alert(`View full details for client ${id}`);
        }
        
        // Contact client
        function contactClient(id) {
            const client = priorityClients.find(c => c.id === id);
            alert(`Contact ${client.contact} at ${client.name}`);
        }
        
        // View reports
        function viewReports(id) {
            window.location.href = `admin-reports.html?client=${id}`;
        }
        
        // Initialize
        loadAlerts();
        renderTierCards();
        renderClients();
        
        // Simulate real-time updates
        setInterval(() => {
            // Update stats with random changes
            const mrrElement = document.querySelector('.stat-value');
            const currentMRR = parseInt(mrrElement.textContent.replace('£', '').replace(',', ''));
            const change = Math.floor(Math.random() * 100) - 50;
            mrrElement.textContent = `£${(currentMRR + change).toLocaleString()}`;
        }, 30000);
    </script>
</body>
</html>